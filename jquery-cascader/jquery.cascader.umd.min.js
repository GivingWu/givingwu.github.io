!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],t):(e=e||self).Cascader=t(e.$)}(this,function(e){"use strict";function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.forEach(function(t){i(e,t,n[t])})}return e}function a(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)i=l[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)i=l[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}e=e&&e.hasOwnProperty("default")?e.default:e;var l=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(~t){var i=e.children();if(i&&i.length)return i.eq(t)}}},s=function(e){return function(t){if(~t){var i=e.children();if(i&&i.length&&t<i.length)return i.slice(t).hide()}}},r=e.noop,o=e.when,d=e.extend,c=e.isArray,h=e.isFunction,u=e.isEmptyObject,v={placeholder:"请选择",ele:".J_Cascader",head:".J_CascaderHead",body:".J_CascaderBody",input:".J_CascaderVal",panelHead:".J_PanelHead",panelBody:".J_PanelBody",panelTpl:'<div class="cascader-panel-item"></div>',panelItemTpl:'<a href="javascript:void(0);" title=""></a>',animation:!0,apiMethod:null,onChange:r,onComplete:r},f=function(){function i(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var n=d({},v,t),a=n.ele,r=n.input,o=n.value,c=n.panelHead,h=n.panelBody,u=e(a),f=u.find(c),p=u.find(h);this.getPrevHead=l(f),this.getPrevBody=l(p),this.checkSurPlusHead=s(f),this.checkSurPlusBody=s(p),this.options=n,this.$doc=e(document),this.$ele=u,this.$head=f,this.$body=p,this.$input=u.find(r),this.activeItem=null,this.activeItems=[],this._initialized=!1,this._bindEvents(),this._loadData(o)}var r,f,p;return r=i,(f=[{key:"_loadData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!isNaN(+t)){var n=this.options.apiMethod;o(n&&n(t,i)).done(function(t){t&&t.length?e._renderPanel(t,i):e.complete()}).fail(console.error)}}},{key:"_bindEvents",value:function(){var e=this.options,t=e.head,i=e.body,n=e.animation,a=this.$ele,l=this.$doc,s=a.find(t),r=a.find(i),o=s.find(".icon");s.click(function(){a.toggleClass("opened"),o.toggleClass("icon-arrow-up"),n?r.slideToggle("fast"):r.show(),l.on("click.toggle.CascaderBody",function(e){var t=e.target;a.is(t)||a.has(t).length||(l.off("click.toggle.CascaderBody"),a.toggleClass("opened"),o.toggleClass("icon-arrow-up"),n?r.slideUp():r.hide())})})}},{key:"_renderPanel",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this,o=this.options,d=o.panelTpl,v=o.panelItemTpl,f=o.onChange,p=o.placeholder,g=this.$head,y=this.$body,b=this.getPrevHead,m=this.getPrevBody,C=this.checkSurPlusHead,I=this.checkSurPlusBody,w=b(i),P=w&&w.length,_=P?w:e(v),k=m(i),O=k&&k.length,x=O?k:e(d);O&&(I(i),y.children().eq(i).show().siblings().hide(),x.children().show().removeClass("active"),c(t)&&s(x)(t.length));var j=l(x),$=null,B=null;if(c(t)&&t.length)for(var T=function(l,s){var o=t[l],d=o.label,c=o.value,u=o.type,p=o.parentId,g=o.active,y=o.disabled,b=o.children,m=a(o,["label","value","type","parentId","active","disabled","children"]),C=n({label:d,value:c,parentId:p},m),I=j(l),w=I&&I.length,P=w?I:e(v);P.text(d).attr("title",d).addClass(function(){return g&&"active"}).addClass(function(){return y&&"disabled"}),w?P.off():x.append(P),g&&(B=C,r.activeItem=C,r.activeItems[i]=C),b&&b.length&&($=b),!y&&P.click(function(){if(e(this).addClass("active").siblings().removeClass("active"),i=_.text(d).attr("title",d).data("value",c).index(),r.activeItem=C,r.activeItems=r.activeItems.slice(0,i+1),r.activeItems[i]=C,h(f)&&f(r.activeItem,r.activeItems,r),c)return r._loadData(c,u)})},q=0,H=t.length;q<H;q++)T(q);B&&!u(B)?_.text(B.label).attr("title",B.label):_.text(p).attr("title",p),P?(C(i),g.off()):g.append(_),_.click(function(){var t=e(this).index();e(this).addClass("active").siblings().removeClass(),y.children().eq(t).show().addClass("active").siblings().hide().removeClass("active")}),!O&&y.append(x),$&&$.length?r._renderPanel($,++i):B&&B.hasChildren&&B.value?r._loadData(B.value,++i):O?(_.addClass("active").siblings().removeClass(),_.show().prevAll().show(),_.nextAll().hide(),y.children().eq(i).show().addClass("active").nextAll().hide().removeClass("active")):(_.addClass("active").siblings().removeClass(),y.children().eq(i).show().addClass("active").siblings().hide().removeClass("active")),!this._initialized&&this._updateInput()}},{key:"getLabelText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ",i=arguments.length>1?arguments[1]:void 0,n=this.$head,a=this.options.placeholder,l=[];return n.children().each(function(){var t=e(this),i=t.text().trim();"none"!==t.css("display")&&i!==a&&l.push(i)}),i?l:l.join(t)}},{key:"complete",value:function(e){!e&&this.$doc.click(),this._updateInput();var t=this.options.onComplete;h(t)&&t(this.activeItem,this.activeItems,this)}},{key:"_updateInput",value:function(){var e=this.$input,t=(this.activeItem||{}).value,i=this.options.placeholder,n=this.getLabelText()||i;"INPUT"===e.prop("tagName")?e.val(n).data("value",t).attr("value",t):e.text(n).data("value",t),this._initialized=!0}}])&&t(r.prototype,f),p&&t(r,p),i}();return e.fn.initCascader=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.each(function(){return new f(h(e)?n({},e,{onComplete:e,ele:this}):n({},e,{ele:this}))})},f});
